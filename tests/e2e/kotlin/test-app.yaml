# Kotlin KMP App E2E Test
# Tests UI hierarchy fetching, various interactions, agentLink functionality, and state management
# Works on both Android and Desktop platforms

project: kmp-app
timeout: 30000

steps:
  # 0. Test Deep Link Pairing (emulator)
  - phase: "Test Deep Link Pairing"
  - pair: emulator
    platform: android
    timeout: 5000

  # 1. Wait for app to be connected and ready
  - phase: "Wait for App Connection"
  - waitFor: increment-button
    timeout: 60000

  # 2. Verify initial UI loaded correctly
  - phase: "Verify Initial UI"
  - assert:
      exists: increment-button

  - assert:
      exists: text-input

  - assert:
      exists: long-press-view

  - assert:
      exists: swipeable-card

  - assert:
      exists: horizontal-scroll

  # 3. Test Tap Interaction (Increment Counter)
  - phase: "Test Tap Interaction"

  - tap: increment-button
    wait: 500

  # Verify counter incremented to 1
  - waitFor: ""
    logContains: "Counter incremented to 1"
    timeout: 3000

  # Tap multiple times
  - tap: increment-button
    wait: 500

  - waitFor: ""
    logContains: "Counter incremented to 2"
    timeout: 3000

  - tap: increment-button
    wait: 500

  - waitFor: ""
    logContains: "Counter incremented to 3"
    timeout: 3000

  # 4. Test Input Interaction
  - phase: "Test Input Interaction"
  
  - input: text-input
    value: "Hello KMP"

  - waitFor: ""
    logContains: "Input changed: Hello KMP"
    timeout: 3000

  # Change input again
  - input: text-input
    value: "Testing input changes"

  - waitFor: ""
    logContains: "Input changed: Testing input changes"
    timeout: 3000

  # 5. Test Long Press Interaction
  - phase: "Test Long Press Interaction"

  - longPress: long-press-view

  - waitFor: ""
    logContains: "Long pressed! Count: 1"
    timeout: 3000

  # Long press again
  - longPress: long-press-view

  - waitFor: ""
    logContains: "Long pressed! Count: 2"
    timeout: 3000

  # 6. Test AgentLink - Reset State (Example 1)
  - phase: "AgentLink Test - Reset State"

  - agentLink: "agenteract://reset_state"

  - waitFor: ""
    logContains: "App state cleared"
    timeout: 3000

  # 7. Verify state was reset
  - phase: "Verify State Reset"

  - sleep: 1000

  # After reset, counter should be back to 0
  - tap: increment-button
    wait: 500

  - waitFor: ""
    logContains: "Counter incremented to 1"
    timeout: 3000

  # 8. Set state again for multiple interaction test
  - phase: "Set State Again"

  - tap: increment-button
    wait: 500

  - tap: increment-button
    wait: 500

  - waitFor: ""
    logContains: "Counter incremented to 3"
    timeout: 3000

  - input: text-input
    value: "Second input"

  - waitFor: ""
    logContains: "Input changed: Second input"
    timeout: 3000

  - longPress: long-press-view

  - waitFor: ""
    logContains: "Long pressed! Count: 1"
    timeout: 3000

  # 9. Test Swipe Interaction
  - phase: "Test Swipe Interaction"

  - swipe: swipeable-card
    direction: left

  - waitFor: ""
    logContains: "Card swiped left"
    timeout: 3000

  # Swipe in different direction
  - swipe: swipeable-card
    direction: right

  - waitFor: ""
    logContains: "Card swiped right"
    timeout: 3000

  # 10. Test Scroll Interaction
  - phase: "Test Scroll Interaction"

  - scroll: horizontal-scroll
    direction: right
    amount: 100

  - waitFor: ""
    logContains: "Scrolled right by 100.0"
    timeout: 3000

  # Scroll in opposite direction
  - scroll: horizontal-scroll
    direction: left
    amount: 50

  - waitFor: ""
    logContains: "Scrolled left by 50.0"
    timeout: 3000

  # 11. Test AgentLink - Reset State Again (Example 2)
  - phase: "AgentLink Test - Second Reset"

  - agentLink: "agenteract://reset_state"

  - waitFor: ""
    logContains: "App state cleared"
    timeout: 3000

  # 12. Verify second reset worked
  - phase: "Verify Second Reset"

  - sleep: 1000

  - tap: increment-button
    wait: 500

  - waitFor: ""
    logContains: "Counter incremented to 1"
    timeout: 3000

  # 13. Build up state for reset button test
  - phase: "Build State for Reset Button"

  - tap: increment-button
    wait: 500

  - tap: increment-button
    wait: 500

  - input: text-input
    value: "Before reset button"

  - waitFor: ""
    logContains: "Input changed: Before reset button"
    timeout: 3000

  - longPress: long-press-view

  - waitFor: ""
    logContains: "Long pressed! Count: 1"
    timeout: 3000

  # 14. Test Manual Reset Button
  - phase: "Test Manual Reset Button"

  - tap: reset-button

  - waitFor: ""
    logContains: "All values reset"
    timeout: 3000

  # 15. Verify manual reset worked
  - phase: "Verify Manual Reset"

  - sleep: 1000

  - tap: increment-button
    wait: 500

  - waitFor: ""
    logContains: "Counter incremented to 1"
    timeout: 3000

  # 16. Simulate app lifecycle via agentLink
  - phase: "Simulate App Lifecycle via AgentLink"

  # Build up some state first
  - tap: increment-button
    wait: 500

  - tap: increment-button
    wait: 500

  - tap: increment-button
    wait: 500

  - input: text-input
    value: "Before lifecycle test"

  - sleep: 500

  # Use agentLink to reset (simulates app state management)
  - agentLink: "agenteract://reset_state"

  - waitFor: ""
    logContains: "App state cleared"
    timeout: 3000

  # 17. Verify app is still responsive after reset
  - phase: "Verify App Responsive After Reset"

  - sleep: 2000

  - waitFor: increment-button
    timeout: 10000

  - assert:
      exists: increment-button

  - assert:
      exists: text-input

  - assert:
      exists: reset-button

  # 18. Final comprehensive interaction test
  - phase: "Final Comprehensive Test"

  - tap: increment-button
    wait: 500

  - waitFor: ""
    logContains: "Counter incremented to 1"
    timeout: 3000

  - input: text-input
    value: "Final test"

  - waitFor: ""
    logContains: "Input changed: Final test"
    timeout: 3000

  - longPress: long-press-view

  - waitFor: ""
    logContains: "Long pressed! Count: 1"
    timeout: 3000

  - swipe: swipeable-card
    direction: left

  - waitFor: ""
    logContains: "Card swiped left"
    timeout: 3000

  - scroll: horizontal-scroll
    direction: right
    amount: 75

  - waitFor: ""
    logContains: "Scrolled right by 75.0"
    timeout: 3000

  # 19. Final agentLink test for comprehensive coverage
  - phase: "Final AgentLink Test"

  - agentLink: "agenteract://reset_state"

  - waitFor: ""
    logContains: "App state cleared"
    timeout: 3000

  # 20. Final state verification
  - phase: "Final State Verification"

  - sleep: 1000

  - waitFor: increment-button
    timeout: 5000

  - assert:
      exists: increment-button

  - assert:
      exists: text-input

  - tap: increment-button
    wait: 500

  - waitFor: ""
    logContains: "Counter incremented to 1"
    timeout: 3000
